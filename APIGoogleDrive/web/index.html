
<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html lang="en">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Login con Google Drive</title>
        <meta name="google-signin-client_id" content="826136231825-kbotigap15d90tvtt2hpeflrge8at6ie.apps.googleusercontent.com">
        <script src="https://apis.google.com/js/client:platform.js?onload=renderButton" async defer></script>
        <script src="js/jquery.min.js"></script>
        <script>

                    var flag = 0;
                    function onSuccess(googleUser) {
                    console.log("entre");
                            var profile = googleUser.getBasicProfile();
                            gapi.client.load('plus', 'v1', function () {
                            var request = gapi.client.plus.people.get({
                            'userId': 'me'
                            });
                                    //Display the user details
                                    request.execute(function (resp) {
                                    //loadDriveApi();
                                    var profileHTML = '<div class="profile"><div class="head">Usuario ' + resp.name.givenName + '! <a href="javascript:void(0);" onclick="signOut();">Salir</a></div>';
                                            profileHTML += '<img src="' + resp.image.url + '"/><div class="proDetails"><p>' + resp.displayName + '</p><p>' + resp.emails[0].value + '</p><p>' + resp.gender + '</p><p>' + resp.id + '</p><p><a href="' + resp.url + '">View Google+ Profile</a></p></div></div>' + ' <p><a href="javascript:void(0);" onclick="loadDriveApi();">Ver Archivos del Google Drive</a></p></div>';
                                            $('.userContent').html(profileHTML);
                                            $('#gSignIn').slideUp('slow');
                                    });
                            });
                    }
            function onFailure(error) {
            alert(error);
            }

            /**
             * Load Drive API client library.
             */
            function loadDriveApi() {
            gapi.client.load('drive', 'v3', listFiles);
            }

            /**
             * Print files.
             */
            function listFiles() {
            gapi.client.load('drive', 'v3', listFiles);
                    var request = gapi.client.drive.files.list({
                    'pageSize': 10,
                    'fields': "nextPageToken, files(id, name)"
                    });
                    request.execute(function (resp) {
                    appendPre('Archivos:');
                    var files = resp.files;
                    if (flag == 0){
                        if (files && files.length > 0 && flag == 0) {
                            for (var i = 0; i < files.length; i++) {
                                
                                var file = files[i];
                                appendPre(file.name + ' (' + file.id + ')');
                            }
                            flag = 1;
                        } else {
                        console.log("no archivos");
                                appendPre('No files found.');
                        }
                    }
                    });
                    
            }

            /*function descargarArchivo(id){
             //String fileId = "0BwwA4oUTeiV1UVNwOHItT0xfa2M";
             OutputStream outputStream = new ByteArrayOutputStream();
             driveService.files().get(id)
             .executeMediaAndDownloadTo(outputStream);
             }
             
             /**
             * Append a pre element to the body containing the given message
             * as its text node.
             *
             * @param {string} message Text to be placed in pre element.
             */
            function appendPre(message) {
                    var pre = document.getElementById('output');
                    var textContent = document.createTextNode(message + '\n');
                    pre.appendChild(textContent);
            }

            function renderButton() {
            gapi.signin2.render('gSignIn', {
            'scope': 'profile email',
                    'width': 240,
                    'height': 50,
                    'longtitle': true,
                    'theme': 'dark',
                    'onsuccess': onSuccess,
                    'onfailure': onFailure
            });
            }
            function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
                    auth2.signOut().then(function () {
            $('.userContent').html('');
                    $('#gSignIn').slideDown('slow');
            });
            }
        </script>
    </head>
    <body>
        <!-- HTML for render Google Sign-In button -->
        <div id="gSignIn"></div>
        <!-- HTML for displaying user details -->
        <div class="userContent"></div>
        <style>
            .profile{
                border: 3px solid #B7B7B7;
                padding: 10px;
                margin-top: 10px;
                width: 350px;
                background-color: #F7F7F7;
                height: 160px;
            }
            .profile p{margin: 0px 0px 10px 0px;}
            .head{margin-bottom: 10px;}
            .head a{float: right;}
            .profile img{width: 100px;float: left;margin: 0px 10px 10px 0px;}
            .proDetails{float: left;}
        </style>
        <pre id="output"></pre>
    </body>
</html>
